name: CI

on:
  pull_request:
    branches:
      - main
      - develop
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '17'
          cache: 'maven'

      - name: Buscar pom.xml y ejecutar Maven
        run: |
          echo "üìç Estoy en la ruta: $(pwd)"
          
          # Buscamos d√≥nde narices est√° el pom.xml
          UBICACION_POM=$(find . -name "pom.xml" -print -quit)
          
          if [ -z "$UBICACION_POM" ]; then
            echo "‚ùå ERROR FATAL: No encuentro ning√∫n archivo pom.xml en todo el repositorio."
            echo "üîç Listado de archivos para depurar:"
            ls -R
            exit 1
          else
            echo "‚úÖ Archivo encontrado en: $UBICACION_POM"
            
            # Verificamos si est√° vac√≠o
            if [ ! -s "$UBICACION_POM" ]; then
               echo "‚ùå ERROR: El archivo pom.xml existe pero est√° VAC√çO (0 bytes). Tienes que ponerle c√≥digo dentro."
               exit 1
            fi

            echo "üöÄ Ejecutando Maven apuntando directamente al archivo..."
            mvn -f "$UBICACION_POM" clean verify
          fi
